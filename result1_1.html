<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>COOK킹 WITH 코RO</title>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        font-family: Arial, sans-serif;
        overflow: hidden;
      }
      .scene {
        display: none;
        width: 100%;
        height: 100%;
      }
      .active {
        display: flex;
      }
      #scene1 {
        background: linear-gradient(white 60%, #fef100);
        justify-content: center;
        align-items: center;
        flex-direction: column;
        position: relative;
      }
      #scene1 .title {
        width: 50vw; /* 50% of the viewport width */
        position: absolute;
        top: 2vh; /* 2% of the viewport height */
        left: 2vw; /* 2% of the viewport width */
      }

      #scene1 .food {
        width: 70vw; /* 70% of the viewport width */
        max-width: 80vw; /* 80% of the viewport width for maximum width */
        height: auto;
        position: absolute;
        top: 7vh; /* 7% of the viewport height from the top */
        left: 70vw; /* 70% of the viewport width from the left */
        transform: translateX(-50%);
      }

      #scene1 .next {
        position: absolute;
        bottom: 2vh;
        right: 1vw;
        width: 18vw;
        max-width: 210px;
        height: auto;
        cursor: pointer;
        transition: opacity 0.5s ease;
        z-index: 100;
      }

      #scene1 .next:hover {
        transform: scale(1.1);
      }
      #scene2,
      #scene3,
      #scene4 {
        background: radial-gradient(circle, #ffffff 10%, #f74fae 65%);
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        user-select: none;
        cursor: none;
        position: relative;
        display: none;
      }
      #scene2.active,
      #scene3.active,
      #scene4.active {
        display: flex;
      }
      #container {
        position: relative;
        width: 600px;
        height: 600px;
        overflow: visible;
      }
      #board {
        position: absolute;
        top: -10px;
        left: 90%;
        transform: translateX(-50%);
        width: 1000px;
        height: auto;
        z-index: 0;
      }
      #ingredient-wrapper {
        display: flex;
        height: 600px;
        position: absolute;
        right: -14vw;
        top: 0;
        z-index: 1;
      }
      .slice {
        height: 100%;
        background-image: url("3dpork.png");
        background-size: 600px 600px;
        background-repeat: no-repeat;
        transition: transform 0.5s ease-in-out;
        flex-shrink: 0;
        pointer-events: none;
      }
      .slice.cut {
        z-index: 10;
      }
      #custom-cursor-2,
      #custom-cursor-3,
      #custom-cursor-4 {
        position: fixed;
        pointer-events: none;
        z-index: 9999;
        transform: translate(-50%, -50%);
      }
      #custom-cursor-2 {
        width: 300px;
        display: none;
      }
      #custom-cursor-3 {
        width: 200px;
        display: none;
      }
      #custom-cursor-4 {
        position: fixed;
        /*   pointer-events: none; */
        z-index: 9999;
        left: 0;
        top: 0;
        width: 80px;
        transform: translate(-40%, -48%) rotate(-65deg); /* shifted left and up */
      }
      #scene2.active #custom-cursor-2,
      #scene3.active #custom-cursor-3 {
        display: block;
      }
      #next-button,
      #next-button-4 {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 200px;
        height: auto;
        cursor: pointer;
        z-index: 1000;
        display: none;
      }

      #next-button-4 {
        cursor: auto; /* shows the real cursor only on this button */
      }

      .image-container {
        position: relative;
        width: 700px;
        height: 500px;
      }
      .image-container img {
        position: absolute;
        top: 0;
        left: 0;
        width: 700px;
        height: auto;
        -webkit-user-drag: none;
      }
      #hidden-image-4 {
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 2;
      }

      .bar {
        position: absolute;
        width: 95vw;
        top: 50px;
      }
      
       .koro {
        width: 30vw;
        top: 20vw;
        left: 5vw;
        position: absolute;
      }
      
      .dialog {
        width: 30vw;
        top: 40vw;
        left: 5vw;
        position: absolute;
          z-index: 0;
      }
      
      .koros2 {
        width: 30vw;
        top: 12vw;
        left: 5vw;
        position: absolute;
      }
      
      .dialogs2 {
        width: 30vw;
        top: 35vw;
        left: 5vw;
        position: absolute;
          z-index: 0;
      }
      

    </style>
  </head>
  <body>
    

    <div id="scene1" class="scene active">
      
          <img class="koro" src="koro.png">
    <img class="dialog" src="dialogporkbellymamaliga.webp">

      <img
        class="title"
        src="porkbellymamaliga.webp"
      />
      <img
        class="food"
        src="porkbellymamaliga.png"
      />
      <img
        class="next"
        src="Next.webp"
        onclick="goToScene(2)"
      />
      <!-- Popup Button as Image -->
<img
  id="info-button"
  src="recipe.webp"
  alt="Recipe"
  style="
    position: absolute;
    top: 30px;
    right: 30px;
    width: 180px;
    height: auto;
    cursor: pointer;
    z-index: 1000;
  "
  onclick="forceDownload(
    'Cooking_with_Koro.pdf'
  )"
/>




      </div>
    </div>

    <div id="scene2" class="scene">
      
                <img class="koros2" src="koro.png">
    <img class="dialogs2" src="mamaligastep1.webp">
      
      <img
        class="bar"
        src="0.webp"
      />
      <img
        id="custom-cursor-2"
        src="Knife.webp"
      />
      <div id="container">
        <img
          id="board"
          src="CuttingBoard.png"
        />
        <div id="ingredient-wrapper"></div>
      </div>
      <img
        id="next-button"
        src="Next.webp"
        onclick="goToScene(3)"
      />
    </div>

    <div id="scene3" class="scene">
      
      <img class="koros2" src="koro.png">
    <img class="dialogs2" src="mamaligastep2.webp">
      
      <img
        class="bar"
        src="50.webp"
      />

      <img
        id="custom-cursor-3"
        src="soysaucebottle.png"
      />

<div style="position: relative; width: 450px; height: auto; margin-top: 10vh;">
        <img
          id="under-image"
          style="
            position: absolute;
            top: 40%;
            left: 100%;
            width: 900px;
            transform: translate(-40%, -45%);
            -webkit-user-drag: none;
          "
          src="PorkCut_Blur.png"
        />
        <img
          id="next-stage-image"
          style="
            position: absolute;
            top: 40%;
            left: 100%;
            width: 900px;
            transform: translate(-40%, -45%);
            opacity: 0;
            z-index: 100;
            pointer-events: none;
            -webkit-user-drag: none;
          "
          src="PorkSoySauce_Blur.png"
        />
      </div>

      <img
        id="next-button"
        src="Next.webp"
        onclick="goToScene(4)"
      />
    </div>

    <div id="scene4" class="scene">
      
      <img class="koros2" src="koro.png">
    <img class="dialogs2" src="mamaligastep3.webp">
      
      <img
        class="bar"
        src="99.webp"
      />
      <div class="image-container">
        <!--       <img id="next-stage-image4" src="https://cdn.glitch.global/33a161c1-563b-45bf-abc1-16ca811d8cb4/image001%20(1).png?v=1744826334416" style="position: absolute; top: 50%; left: 50%; width: 700px; transform: translate(-50%, -50%); -webkit-user-drag: none;" /> -->
        <img
          id="water-image"
          style="
            opacity: 1;
            transition: opacity 0.3s ease;
            position: absolute;
            top: calc(50% + 50px);
            left: 80%;
            transform: translate(-40%, -50%);
            width: 900px;
            -webkit-user-drag: none;
          "
          src="Water.png"
        />

        <img
          id="hidden-image-4"
          style="
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            position: absolute;
            top: calc(50% + 50px);
            left: 80%;
            transform: translate(-40%, -50%);
            width: 900px;
            -webkit-user-drag: none;
          "
          src="Polenta.png"
        />
      </div>
      <img
        id="custom-cursor-4"
        src="spoon.webp"
      />
      <img id="next-button-4"
      src="Next.webp"
      style="display: none" onclick="window.location.href='final1.html'" cursor:
      auto; />
    </div>

    <script>
     function forceDownload(url, filename) {
  fetch(url)
    .then(response => response.blob())
    .then(blob => {
      const blobUrl = window.URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = blobUrl;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      window.URL.revokeObjectURL(blobUrl);
    })
    .catch(console.error);
}


      const wrapper = document.getElementById("ingredient-wrapper");
      const sliceCount = 5;
      const sliceWidth = 600 / sliceCount;
      let currentSlice = 0;
      let enableSlicing = false;
      let firstClickSkipped = false;

      document.getElementById("info-button").addEventListener("click", () => {
        document.getElementById("popup-modal").style.display = "block";
      });

      function closePopup() {
        document.getElementById("popup-modal").style.display = "none";
      }

      function goToScene(sceneNum) {
        document
          .querySelectorAll(".scene")
          .forEach((el) => el.classList.remove("active"));
        const newScene = document.getElementById(`scene${sceneNum}`);
        newScene.classList.add("active");

        // Hide the popup and button when not in Scene 1
        const infoButton = document.getElementById("info-button");
        const popupModal = document.getElementById("popup-modal");
        if (sceneNum !== 1) {
          if (infoButton) infoButton.style.display = "none";
          if (popupModal) popupModal.style.display = "none";
        } else {
          if (infoButton) infoButton.style.display = "block";
        }

        if (sceneNum === 2) {
          currentSlice = 0;
          createSlices();
          document.querySelector("#scene2 #next-button").style.display = "none";
          enableSlicing = false;
          firstClickSkipped = false;

          setTimeout(() => {
            enableSlicing = true;
          }, 100);
        } else {
          enableSlicing = false;
        }
      }

      function createSlices() {
        wrapper.innerHTML = "";
        for (let i = 0; i < sliceCount; i++) {
          const slice = document.createElement("div");
          slice.classList.add("slice");
          slice.style.width = `${sliceWidth}px`;
          slice.style.backgroundPosition = `-${i * sliceWidth}px 0px`;
          wrapper.appendChild(slice);
        }
      }

      function goToScene(sceneNum) {
        document
          .querySelectorAll(".scene")
          .forEach((el) => el.classList.remove("active"));
        const newScene = document.getElementById(`scene${sceneNum}`);
        newScene.classList.add("active");

        if (sceneNum === 2) {
          currentSlice = 0;
          createSlices();
          document.querySelector("#scene2 #next-button").style.display = "none";
          enableSlicing = false;
          firstClickSkipped = false;

          // Delay to skip initial click that triggers scene2
          setTimeout(() => {
            enableSlicing = true;
          }, 100);
        } else {
          enableSlicing = false;
        }
      }

      document.addEventListener("click", () => {
        if (
          document.getElementById("scene2").classList.contains("active") &&
          currentSlice < sliceCount &&
          enableSlicing
        ) {
          if (!firstClickSkipped) {
            firstClickSkipped = true;
            return;
          }

          const slice = wrapper.children[currentSlice];
          const middle = (sliceCount - 1) / 2;
          const direction = currentSlice < middle ? -1 : 1;
          const movement =
            direction * (Math.abs(currentSlice - middle) * (40 / middle) + 8);
          const rotation = Math.random() * 6 - 3;
          slice.classList.add("cut");
          slice.style.transform = `translateX(${movement}px) rotate(${rotation}deg)`;
          currentSlice++;
          if (currentSlice === sliceCount) {
            document.querySelector("#scene2 #next-button").style.display =
              "block";
          }
        }
      });

      // Original scene3/scene4 logic unchanged — include your existing logic here:
      let isHolding = false;
      let opacity = 0;
      let hasRevealedFully = false;

      document.addEventListener("mousemove", (e) => {
        const c2 = document.getElementById("custom-cursor-2");
        const c3 = document.getElementById("custom-cursor-3");
        const c4 = document.getElementById("custom-cursor-4");

        if (
          c2 &&
          document.getElementById("scene2").classList.contains("active")
        ) {
          c2.style.left = `${e.clientX}px`;
          c2.style.top = `${e.clientY}px`;
        }

        if (
          c3 &&
          document.getElementById("scene3").classList.contains("active")
        ) {
          c3.style.left = `${e.clientX}px`;
          c3.style.top = `${e.clientY}px`;
          if (isHolding && opacity < 1) {
            opacity += 0.002;
            document.getElementById("next-stage-image").style.opacity =
              opacity.toFixed(3);
            if (opacity >= 1 && !hasRevealedFully) {
              hasRevealedFully = true;
              setTimeout(() => {
                document.querySelector("#scene3 #next-button").style.display =
                  "block";
              }, 300);
            }
          }
        }

        if (
          c4 &&
          document.getElementById("scene4").classList.contains("active")
        ) {
          c4.style.left = `${e.clientX}px`;
          c4.style.top = `${e.clientY}px`;

          const dx = e.clientX - lastX;
          const dy = e.clientY - lastY;
          const angle = Math.atan2(dy, dx);
          const distance = Math.sqrt(dx * dx + dy * dy);

          if (distance < 20) {
            angleHistory.push({ angle });
            if (angleHistory.length > 10) angleHistory.shift();

            let angleDiffSum = 0;
            for (let i = 1; i < angleHistory.length; i++) {
              let diff = angleHistory[i].angle - angleHistory[i - 1].angle;
              diff = ((diff + Math.PI) % (2 * Math.PI)) - Math.PI;
              angleDiffSum += Math.abs(diff);
            }

            if (angleDiffSum > 2 * Math.PI && opacity4 < 1) {
              opacity4 += 0.04;
              const hiddenImage4 = document.getElementById("hidden-image-4");
              hiddenImage4.style.opacity = opacity4;
            }

            if (opacity4 >= 1 && !nextShown4) {
              document.getElementById("next-button-4").style.display = "block";
              nextShown4 = true;
            }
          }

          lastX = e.clientX;
          lastY = e.clientY;
        }
      });

      document.addEventListener("mousedown", () => {
        isHolding = true;
      });
      document.addEventListener("mouseup", () => {
        isHolding = false;
      });

      let lastX = 0,
        lastY = 0,
        angleHistory = [],
        opacity4 = 0,
        nextShown4 = false;
    </script>
  </body>
</html>
